
# 内存管理
> memory manage





---
## 链接装入

##### 用户程序在操作系统中的运行所要经历的步骤：

- 编译
- 链接
- 装入

### 1.链接

- 静态链接方式

在程序运行之前，先将各自目标模块及它们所需的库函数链接成一个完整的装配模块，以后不再拆开。

- 装入时动态链接方式

将用户源程序编译后所得到的一组目标模板，在装入内存时，采用边装如边链接的方式。即在装入一个目标模板时，若发生一个外部模块调用事件，将引用装入程序去找出相应的外部目标模板，并将它装入内存。

- 运行时动态链接方式

### 2.装入

- 绝对装入方式
- 可重定位装入方式
- 动态运行时的装入方式


---

## 连续分配

为一个用户程序分配一个连续的内存空间。

### 1.单一连续分配

### 2.固定分区分配

##### 划分分区

- 分区大小相等
- 分区大小不等

### 3.动态分区分配

##### 数据结构

- 空闲分区表
- 空闲分区链

##### 分区操作

- 分配内存
- 回收内存

### 4.动态分区分配算法

##### 基于顺序搜索的动态分区分配算法

- 首次适应算法FF——First Fit

- 循环首次适应算法NF——Next Fit

- 最佳适应算法BF——Best Fit

- 最坏适应算法WF——Worst Fit

##### 基于索引搜索的动态分区分配算法

- 快速适应算法——Quick Fit
- 伙伴系统——Buddy System
- 哈希算法

### 5.动态可重定位分区分配

##### 紧凑

##### 动态重定位

须在系统中增设一个重定位寄存器，用来存放程序或数据在内存中的起始地址。


## 交换
> swap

交换是指把内存中暂时不能运行的进程或暂时不用的程序和数据块换出到外存上，以便腾出足够的内存空间，再把已具备运行条件的进程或进程所需要的程序和数据换入内存。

##### 交换类型

- 整体交换：以整个进程为单位进行交换。
- 部分交换：以进程的一个页面或分段为单位进行交换。

磁盘空间分为文件区和交换区两部分

- 对文件区空间的管理采取离散分配方式
- 对交换区空间的管理采用连续分配方式





---
## 分配方式

- 1.连续分配

- 2.离散分配
    - 分页
    - 分段
    - 段页式



---
## 段页式存储管理方式

### 分页与分段

##### 1.同：

- 离散分配方式
- 地址变换（地址映射）

##### 2.异：

- 页是信息的物理单位；段是信息的逻辑地址。
- 页的大小是固定的，由系统决定；段的长度是可变的，由程序决定。
- 分页的用户程序地址空间是一维的；分段的用户程序地址空间是二维的。

##### 段页式原理

结合分段和分页原理，先将用户程序分成若干个段，再将每个段分成若干个页。

##### 段页式地址

- 段号
- 段内页号
- 页内地址


# 分段存储管理方式

##### 引入分段存储管理方式

- 方便编程
- 信息共享
- 信息保护
- 动态增长
- 动态链接

##### 分段地址

- 段号
- 段内地址

##### 段表

实现从作业空间的逻辑地址到内存空间的物理地址的地址映射

- 段号：段名
- 基址：段在内存空间的起始地址
- 段长：段的地址范围长度

##### 地址变换

在系统中设置了段表寄存器，用于存储段表始址和段表长度。

##### 分段实现段的信息共享
---
## 分页存储管理方式

- 页号：将进程的逻辑地址空间分成若干个页，并为各页加以编号
- 块号：将内存的物理地址空间分成若干个块，并为各块加以编号
- 页大小和块大小相等，常为2的幂
- 页表的作用是实现从进程逻辑页号到内存物理块号的地址映射

##### 分页地址

- 页号
- 页内地址

### 地址变换机构

将用户地址空间中的逻辑地址转换为内存中的物理地址。

##### 基本的地址变换机构

页表大多驻留在内存中，在系统中只设置一个页面寄存器，其中存放页表在内存中的起始地址和页表的长度。

##### 具有快表的地址变换机构

在地址变换机构中增设一个具有并行查询能力的特殊高速缓存寄存器。







## 虚拟存储

### 1.虚拟存储器

从逻辑上对内存容量加以扩充的一种存储器系统

- 其逻辑容量由内存容量和外存容量之和所决定
- 其速度接近与内存速度
- 其成本接近于外存成本。

##### 特征：

- 多次性
- 对换性
- 虚拟性

### 2.请求分页存储管理方式

##### 请求页表机制

| 页号 | 块号 | 存在位 | 访问字段 | 修改位 | 外存地址 |
| :---: | :---: | :---: | :---: | :---: | :---: |


##### 缺页中断机构

缺页中断与普通中断的区别

- 在指令执行期间产生和处理缺页中断信号
- 一条指令在执行期间可能产生多次缺页中断

##### 地址变换机构

图

##### 内存分配策略

- 固定分配局部置换
- 可变分配全局置换
- 可变分配局部置换

##### 页面调入策略

- 预测调页策略
- 请求调页策略

##### 缺页率

f=F/A

- f：进程运行过程中的缺页率
- A：进程运行过程中访问内存和外存中页面的次数
- F：进程运行过程中访问外存中页面的次数

##### 页面置换算法

- 最佳置换算法——Optimal：将未来最长时间内不被访问的页面淘汰
- 先进先出置换算法FIFO——First In First Out
- 最近最久未使用置换算法LRU——Least Recently Unused
- 最近最少使用置换算法LFU——Least Frequently Used
- 检查置换算法——Clock

##### 页面缓存算法

PBA算法特点：

- 显著地降低了页面换进，换出地频率，使磁盘I/O地操作次数大为减少，因而减少了页面换进，换出的开销。
- 正是由于换入换出的开销大幅度减少，才能使其采用一种较简单的置换策略。

##### 抖动

##### 工作集

### 3.请求分段存储管理方式

##### 请求段表机制

| 段号 | 段长 | 基址 | 存取方式 | 访问字段 | 修改位 | 存在位 | 增补位 | 外存地址 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |


##### 缺段中断机构

图

##### 地址变换机构

图

##### 分段共享

##### 分段保护





